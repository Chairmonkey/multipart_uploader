<html>
	<head>
		<title>&#220;pload</title>
	</head>
	<body>
		<h1>&#220;pload</h1>
		<form enctype="multipart/form-data" action="/upload" method="post">
			<input type="file" name="upload" multiple="multiple"><br>
			<div style="height: 15px; width:100%;" id="upload_stats">
				<span id="status" style="display: none;">
					<strong>Status:</strong>
					<span id="percentage"></span>
				</span>
				<a id="file_link"></a>
			</div>
			<textarea name="description" rows="4"></textarea><br />
			<input type="submit" />
		</form>

		<footer>
			<script src="/socket.io/socket.io.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
			<script src="http://malsup.github.com/jquery.form.js"></script> 
			<script type="text/javascript">
				$(document).ready(function() {
					var formOptions =
						{
							type: 'post',
							dataType: 'html',
							clearForm: true,
							success: showResponse
						};

					$("form").ajaxForm(formOptions);

					// Set up socket for receiving progress events
					var socket = io.connect('http://localhost:8000');

					// Add the socket's session id onto the form so we can parse it out
					// server side
					socket.on("connect", function() {
						$("form").attr("action", "/upload?sid=" + socket.socket.sessionid);
					});

					// Update the status when receiving progress updates
					socket.on('message', function(data) {
						$("#status").show();
						$("#percentage").text(data + "%");
					});

					// Submit form when images is selected, as long as the user selected a file
					$("input:file").change(function() {
						if ($(this).val() != "") {
							$("form").submit();
							$("#file_link").text("");
						}
					});

					function showResponse(responseText, statusText, xhr, $form) {
						$("#file_link").attr("href", '/uploads/' + responseText).text("View file here");
					}
				});
			</script>
		</footer>
	</body>
</html