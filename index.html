<html>
	<head>
		<title>&#220;pload</title>
	</head>
	<body>
		<h1>&#220;pload</h1>
		<form enctype="multipart/form-data" action="/upload" method="post">
			<input type="file" name="upload" multiple="multiple"><br>
			<div style="height: 15px; width:100%;" id="upload_stats">
				<span id="status" style="display: none;">
					<strong>Status:</strong>
					<span id="percentage"></span>
				</span>
			</div>
			<textarea name="description" rows="4"></textarea><br />
			<input type="submit" />
		</form>

		<footer>
			<script src="/socket.io/socket.io.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
			<script src="http://malsup.github.com/jquery.form.js"></script> 
			<script type="text/javascript">
				$(document).ready(function() {
					var formOptions =
						{
							type: 'post',
							dataType: 'html',
							clearForm: true,
							success: showResponse
						};

					$("form").ajaxForm(formOptions);
					var progress_socket = io.connect('http://localhost:8000');

					progress_socket.on("connect", function() {
						console.log("connected to server");
						$("form").attr("action", "/upload?sid=" + progress_socket.socket.sessionid);
					});

					progress_socket.on('message', function(data) {
						$("#status").show();
						$("#percentage").text(data + "%");
					});

					$("input:file").change(function() {
						$("form").submit();
					});

					function showResponse(responseText, statusText, xhr, $form) {
						$("#upload_stats").append("<a href='/uploads/" + responseText + "'>View file here</a>");
					}
				});
			</script>
		</footer>
	</body>
</html